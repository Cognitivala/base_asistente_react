
<html lang="es-CL" dir="ltr" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://ogp.me/ns/fb#" heightfull="heightfull">
  <head>
    <title>Interacciones Valoradas. MAD Cognitiva</title>
    <meta charset="UTF-8"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="apple-touch-icon" sizes="57x57" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="http://asistente-react.mycognitiva.io/assets/img/favicon/apple-icon-180x180.png"/>
    <link rel="icon" type="image/png" sizes="192x192" href="http://asistente-react.mycognitiva.io/assets/img/favicon/android-icon-192x192.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="http://asistente-react.mycognitiva.io/assets/img/favicon/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="96x96" href="http://asistente-react.mycognitiva.io/assets/img/favicon/favicon-96x96.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="http://asistente-react.mycognitiva.io/assets/img/favicon/favicon-16x16.png"/>
    <link rel="manifest" href="http://asistente-react.mycognitiva.io/assets/img/favicon/manifest.json"/>
    <meta name="msapplication-TileColor" content="#000000"/>
    <meta name="msapplication-TileImage" content="http://asistente-react.mycognitiva.io/assets/img/favicon/ms-icon-144x144.png"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="_csrf" content=""/>
    <meta name="insight-app-sec-validation" content="4d0a31e7-ca78-40a0-b0dd-a0b8415541e4"/>
    <meta name="apptrana" content="37adefb730ca40ca9d12cb9e55ed2ca3"/>
    <link href="http://asistente-react.mycognitiva.io/assets/css/main.css" rel="stylesheet"/>
    <link href="http://asistente-react.mycognitiva.io/assets/img/favicon/favicon-32x32.png" rel="Shortcut Icon"/><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
  </head>
  <body class="no-scroll" heightfull="heightfull">
    <div id="wrapper" heightfull="heightfull">
      <div class="f-row" heightfull="heightfull">
        <div class="f-col menu" heightfull="heightfull" padding="padding">
          <div class="header">
            <div class="f-row align-center">
              <div class="f-col cognitiva-logo"><img src="http://asistente-react.mycognitiva.io/assets/img/cognitiva-logo.png" alt=""/></div>
            </div>
          </div>
          <ul class="menu" id="mainmenu">
            <li><a href="http://asistente-react.mycognitiva.io/"><i class="fa fa-cog" aria-hidden="true"></i>Configurar Asistente</a></li>
            <li><a href="http://asistente-react.mycognitiva.io/personalizar/"><i class="fa fa-paint-brush" aria-hidden="true"></i>Personalizar Asistente</a></li>
            <li><a href="http://asistente-react.mycognitiva.io/indicadores/"><i class="fa fa-bar-chart" aria-hidden="true"></i>Indicadores</a>
              <ul class="sub-menu">
                <li><a href="http://asistente-react.mycognitiva.io/indicadores/interacciones/"><i class="fa fa-caret-right" aria-hidden="true"></i>Interacciones</a></li>
                <li><a href="http://asistente-react.mycognitiva.io/indicadores/valoraciones/"><i class="fa fa-caret-right" aria-hidden="true"></i>Valoraciones</a></li>
                <li><a href="http://asistente-react.mycognitiva.io/indicadores/tmo/"><i class="fa fa-caret-right" aria-hidden="true"></i>TMO</a></li>
                <li><a href="http://asistente-react.mycognitiva.io/indicadores/origen/"><i class="fa fa-caret-right" aria-hidden="true"></i>Origen</a></li>
                <li><a href="http://asistente-react.mycognitiva.io/indicadores/nps/"><i class="fa fa-caret-right" aria-hidden="true"></i>NPS</a></li>
              </ul>
            </li>
            <li id="admin-users-btn"><a href="http://asistente-react.mycognitiva.io/administrador-usuarios/"><i class="fa fa-users" aria-hidden="true"></i>Administrador Usuarios</a></li>
            <li><a class="get-code" href="#;" onclick="openScript()"><i class="fa fa-code" aria-hidden="true"></i>Obtener código</a></li>
          </ul>
        </div>
        <div class="f-col content" padding="padding" heightfull="heightfull">
          <div class="row">
            <div class="col-md-12 content-header">
              <div class="mad-cognitiva">
                <h5>Mantenedor Asistente Digital / <span></span></h5>
              </div>
              <button class="user" button="button" onclick="closeSession()">
                <div id="user">Hola, <span>Ernesto</span></div><i class="fa fa-hand-peace-o"></i>
              </button>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h1 class="title-page">Interacciones Valoradas</h1>
              <div class="container-tabs">
                <ul class="nav nav-tabs" id="tabs" role="tablist">
                  <li class="active" role="presentation"><a href="#last-days" aria-controls="last-days" role="tab" data-toggle="tab"><span>Últimos 30 días</span></a></li>
                  <li role="presentation"><a href="#by-range" aria-controls="by-range" role="tab" data-toggle="tab"><span>Por rango</span></a></li>
                  <li role="presentation"><a href="#by-week" aria-controls="by-week" role="tab" data-toggle="tab"><span>Por semana</span></a></li>
                  <li role="presentation"><a href="#by-hour" aria-controls="by-hour" role="tab" data-toggle="tab"><span>Por hora</span></a></li>
                  <li role="presentation"><a href="#ranking" aria-controls="by-hour" role="tab" data-toggle="tab"><span>Ranking</span></a></li>
                </ul>
                <div class="tab-content has-title">
                  <div class="tab-pane fade in active" id="last-days" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <div class="form" onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="last30" type="text" data-date-end-date="0d" name="last30" placeholder="Seleccione"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group select">
                                      <select class="box-field" id="last30-channel">
                                        <option value="" selected="selected" disabled="disabled">Selecciona canal</option>
                                        <option value="App">App</option>
                                        <option value="SitioPublico">Sitio Público</option>
                                        <option value="SitioPrivado">Sitio Privado</option>
                                      </select><span class="input-group-addon"><i class="fa fa-sort-down" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('last30', 'interacciones_valoradas', 'last-days', 'chart_div', 'last30-channel')">Filtrar</button>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Interacciones <b>últimos 30 días</b> <span></span></h5>
                            <div id="chart_div"></div>
                          </div>
                        </div>
                      </div><a class="download-cvs" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="by-range" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="desde" type="text" data-date-end-date="0d" name="" placeholder="Seleccione desde"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="hasta" type="text" data-date-end-date="0d" name="" placeholder="Seleccione hasta"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group select">
                                      <select class="box-field" id="desde-channel">
                                        <option value="">Selecciona canal</option>
                                        <option value="App">App</option>
                                        <option value="SitioPublico">Sitio Público</option>
                                        <option value="SitioPrivado">Sitio Privado</option>
                                      </select><span class="input-group-addon"><i class="fa fa-sort-down" aria-hidden="true"> </i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('desde', 'interacciones_valoradas', 'by-range', 'chart_by_range', 'desde-channel')">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Interacciones <b>entre fechas</b></h5>
                            <div id="chart_by_range"></div>
                          </div>
                        </div>
                      </div><a class="download-cvs" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="by-week" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="week" type="text" data-date-end-date="0d" name="" placeholder="Seleccione un día"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group select">
                                      <select class="box-field" id="week-channel">
                                        <option value="">Selecciona canal</option>
                                        <option value="App">App</option>
                                        <option value="SitioPublico">Sitio Público</option>
                                        <option value="SitioPrivado">Sitio Privado</option>
                                      </select><span class="input-group-addon"><i class="fa fa-sort-down" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('week', 'interacciones_valoradas', 'by-week', 'chart_by_week', 'week-channel')">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Interacciones <b>por semanas</b></h5>
                            <div id="chart_by_week"></div>
                          </div>
                        </div>
                      </div><a class="download-cvs" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="by-hour" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="hour" type="text" data-date-end-date="0d" name="" placeholder="Seleccione día"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group select">
                                      <select class="box-field" id="hour-channel">
                                        <option value="">Selecciona canal</option>
                                        <option value="App">App</option>
                                        <option value="SitioPublico">Sitio Público</option>
                                        <option value="SitioPrivado">Sitio Privado</option>
                                      </select><span class="input-group-addon"><i class="fa fa-sort-down" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('hour', 'interacciones_valoradas', 'by-hour', 'chart_by_hour', 'hour-channel')">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Interacciones <b>por hora</b></h5>
                            <div id="chart_by_hour"></div>
                          </div>
                        </div>
                      </div><a class="download-cvs" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="ranking" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="desde-ranking" type="text" data-date-end-date="0d" name="" placeholder="Seleccione desde"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="hasta-ranking" type="text" data-date-end-date="0d" name="" placeholder="Seleccione hasta"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group select">
                                      <select class="box-field" id="ranking-channel">
                                        <option value="">Selecciona canal</option>
                                        <option value="App">App</option>
                                        <option value="SitioPublico">Sitio Público</option>
                                        <option value="SitioPrivado">Sitio Privado</option>
                                      </select><span class="input-group-addon"><i class="fa fa-sort-down" aria-hidden="true"> </i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getRanking()">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Ranking de interacciones</b></h5>
                            <table class="table table-striped table-bordered" id="chart_by_ranking">
                              <thead>
                                <tr>
                                  <th>#</th>
                                  <th>Intent</th>
                                  <th>Frecuencia</th>
                                  <th>% valoración</th>
                                  <th>Canal</th>
                                  <th>Valoración</th>
                                  <th>Fue útil</th>
                                </tr>
                              </thead>
                              <tbody></tbody>
                            </table>
                          </div>
                        </div>
                      </div><a class="download-cvs" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i></button>
            <h6 class="modal-title"></h6>
          </div>
          <div class="modal-body"></div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="myModalScript" tabindex="-1" role="dialog" aria-labelledby="myModalScriptLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i></button>
            <h6 class="modal-title">Copia y pega el siguiente código en tu web. Después de <span class="code"><span>&lt;</span>head<span>&gt;</span></span> y antes de <span class="code"><span>&lt;/</span>head<span>&gt;</span></span></h6>
          </div>
          <div class="modal-body">
            <pre text-left="text-left"></pre>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://asistente-react.mycognitiva.io/assets/js/moment.min.js"></script>
    <script type="text/javascript" src="http://asistente-react.mycognitiva.io/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://asistente-react.mycognitiva.io/assets/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="http://asistente-react.mycognitiva.io/assets/js/date.js"></script>
    <script type="text/javascript" src="http://asistente-react.mycognitiva.io/assets/js/main.js"></script>
    <script>
      var d = new Date();
      var e = new Date();
          f = e.setDate(e.getDate() - 30);
          w = e.setDate(e.getDate() - 10);
          g = new Date(f);
      
      var valArray = [],
          promise;
      
      var month = new Array();
          month[0] = "Enero";
          month[1] = "Febrero";
          month[2] = "Marzo";
          month[3] = "Abril";
          month[4] = "Mayo";
          month[5] = "Junio";
          month[6] = "Julio";
          month[7] = "Agosto";
          month[8] = "Septiembre";
          month[9] = "Octubre";
          month[10] = "Noviembre";
          month[11] = "Diciembre";
      
      var n = month[d.getMonth()],
          getSession = "1",
          getTkn = sessionStorage.getItem('tkn');
          //- getTheToken = '';
      
      //- if (sessionStorage.getItem('tkn')) {
      //-   getTheToken = '?token='+sessionStorage.getItem('tkn');
      //- } else {
      //-   getTheToken = '';
      //- }
      
      function getRanking(){
        $.ajax({
          type: 'POST',
          url: getPath+'mant/ranking',
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer "+getTkn
          },
          data:  JSON.stringify(
            {
              inicio: $('#desde-ranking').val() ? $('#desde-ranking').val() :  moment().subtract(30, 'days').format('YYYY-MM-DD'),
              fin: $('#hasta-ranking').val() ? $('#hasta-ranking').val() :  moment().format('YYYY-MM-DD'),
              id_cliente: getSession,
              canal: $('#ranking-channel').val() ? $('#ranking-channel').val() : 'all'
            }
          ),
          dataType: 'json',
          contentType: 'application/json; charset=utf-8'
        }).done(function(response){
          createCSV(response.csv, 'ranking');
      
          var data = response.descripcion,
              html = '',
              $container = $('#chart_by_ranking');
      
          $('.error-msg').remove();
      
          if(response.status == 400){
            html += '<p class="error-msg">'+ data +'</p>';
            $container.find('tbody').html('');
            $container.parent().append(html)
          }else{
            for(var i = 0; i < data.length; i++){
              html += '<tr>';
              html += '<td>'+ (i + 1) +'</td>';
              html += '<td>'+ data[i].dominio +'</td>';
              html += '<td>'+ data[i].frecuencia +'</td>';
              html += '<td>'+ Math.round( (data[i].porcentaje_valoracion * 100) * 10) / 10  +'%</td>';
              html += '<td>'+ data[i].canal +'</td>';
              html += '<td>'+ Math.round( (data[i].valoraciones) * 10) / 10  +'</td>';
              html += '<td>';
              html += '<span class="splitBox">';
              html += '<span class="splitTerm">Si</span>';
              html += '<span class="splitValue">'+ Math.round( (data[i].si * 100) * 10) / 10  +'%</span>';
              html += '</span>';
              html += '<span class="splitBox">';
              html += '<span class="splitTerm">No</span>';
              html += '<span class="splitValue">'+ Math.round( (data[i].no * 100) * 10) / 10  +'%</span>';
              html += '</span>';
              html += '</td>';
              html += '</tr>';
            }
            $container.find('tbody').html(html);
          }
        });
      }
      
      function getDateInput(input, type, tab, chartName, selector){
      
        var getInputVal   = document.getElementById(input).value || new Date().toISOString().slice(0,10),
            getDesde      = document.getElementById('desde').value,
            getHasta      = document.getElementById('hasta').value,
            desdeDate     = new Date(getDesde),
            hastaDate     = new Date(getHasta),
            getDate       = new Date(getInputVal),
            dateStart     = '',
            dateEnd       = '',
            getInputEnd   = getHasta;
      
        var getMonth      = getDate.getMonth(),
            getYear       = getDate.getFullYear();
      
        var lastDay       = new Date(getYear, getMonth + 1, 0),
            formatDate    = getDate.setDate(getDate.getDate() - 30),
            getDateFormat = new Date(formatDate),
            getDateFormat = getDateFormat.toISOString().substring(0,10);
      
        var myResponse    = '';
      
        if(tab == 'last-days'){
          dateEnd = getInputVal;
          dateStart = moment(getInputVal, "YYYY-MM-DD").subtract(30, 'days').format('YYYY-MM-DD');
          getInteractions(type, dateStart, dateEnd, getSession, chartName, selector);
          //- getInteractions_val('interacciones_valoradas', dateStart, dateEnd, getSession, selector);
        }else if(tab == 'by-week'){
          dateEnd = getInputVal;
          dateStart = moment(getInputVal, "YYYY-MM-DD").subtract(7, 'days').format('YYYY-MM-DD');
          getInteractions(type, dateStart, dateEnd, getSession, chartName, selector);
          //- getInteractions_val('interacciones_valoradas', dateStart, dateEnd, getSession, selector);
        }else if(tab == 'by-hour'){
          getInteractions(type, getInputVal, getInputVal, getSession, chartName, selector);
          //- getInteractions_val('interacciones_valoradas', dateStart, dateEnd, getSession, selector);
        }else {
          if(desdeDate >= hastaDate) {
            $('#desde, #hasta').addClass('error');
            $('#desde, #hasta').parent().find('.input-group-addon').addClass('error');  
          } else {
            $('#desde, #hasta').removeClass('error');
            $('#desde, #hasta').parent().find('.input-group-addon').removeClass('error');
            dateEnd = getHasta ? getHasta : moment().format('YYYY-MM-DD');
            dateStart = getDesde ? getDesde : moment().subtract(30, 'days').format('YYYY-MM-DD');
            getInteractions(type, dateStart, dateEnd, getSession, chartName, selector);
            //- getInteractions_val('interacciones_valoradas', dateStart, dateEnd, getSession, selector);
          }
        }
        return false;
      }
      
      $('.date-picker-days').datepicker({
        language: 'es',
        minViewMode: 'days'
      });
      
      function getInteractions_val(tipo, fechaIni, fechaFin, id, selector){
        var getCanal = document.getElementById(selector).value;
        if(getCanal == ''){
          getCanal = "all";
        }
        var promise = $.ajax({
          type: 'POST',
          url: getPath+'mant/filtros',
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer "+getTkn
          },
          data:  JSON.stringify(
            {
              tipo: tipo,
              inicio: fechaIni,
              fin: fechaFin,
              id_cliente: id,
              canal: getCanal
            }
          ),
          dataType: 'json',
          contentType: 'application/json; charset=utf-8'
        }).done(function(response){
          createCSV(response.csv, 'interacciones_valoradas');
          for(var i = 0; i < response.respuesta.length; i++) {
            valArray.push(response.respuesta[i].total);
          }
          //- promise = valArray;
          //- console.log('promise', promise);
        });
      }
      
      function getInteractions(tipo, fechaIni, fechaFin, id, divId, selector){
        var getCanal = document.getElementById(selector).value;
        if(getCanal == ''){
          getCanal = "all";
        }
        var promise = $.ajax({
          type: 'POST',
          url: getPath+'mant/filtros',
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer "+getTkn
          },
          data:  JSON.stringify(
            {
              tipo: tipo,
              inicio: fechaIni,
              fin: fechaFin,
              id_cliente: id,
              canal: getCanal
            }
          ),
          dataType: 'json',
          contentType: 'application/json; charset=utf-8'
        }).done(function(response){
          debugger;
          if(response.status == 400){
            $('#'+divId).html('<p>No se han encontrado datos</p>')
            return false;
          }else{
            var data = [
              ['Día', 'Totales', 'Valoradas']
            ];
            var responseData = response.respuesta;
      
            for(var i = 0; i < responseData.length; i++){
              var day = parseInt(responseData[i].dia)+' '+month[parseInt(responseData[i].mes) - 1];
              if($('#by-hour').hasClass('active') == true)
                day = responseData[i].hora + ':00';
              data.push([day, responseData[i].total_interacciones, responseData[i].total_interacciones_valoradas])
            }
      
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);
      
            function drawChart() {
              var arrayData = google.visualization.arrayToDataTable(data)
              var getMyArray = [['días', 'interacciones', 'interacciones valoradas']];
      
              var options = {
                  height: 280,
                  hAxis: {
                    textStyle: {
                      fontName: 'Roboto',
                      bold: true
                    },
                    title: '',
                    titleTextStyle: {
                      color: '#f00'
                    },
                    minValue: 1,
                    maxValue: (getMyArray.length - 1),
                    gridlines: {
                      color: 'none'
                    }
                  },
                  vAxis: {
                    minValue: 0,
                    textStyle: {
                      fontName: 'Roboto',
                      bold: true
                    }
                  },
                  chartArea:{
                    left: '5%',
                    top: '5%',
                    width: '93%',
                    height: '75%'
                  },
                  crosshair: {
                    focused: {
                      color: '#3bc',
                      opacity: 0.8
                    }
                  },
                  legend: 'none',
                  pointSize: 9,
                  tooltip: {
                    showColorCode: true,
                    textStyle: {
                      color: '#1c75bc',
                      fontName: 'Roboto',
                    }
                  },
                  colors:['#007fa3', '#001e37'],
                  areaOpacity: 0.9,
                  backgroundColor: { fill:'transparent' }
                };
                var chart = new google.visualization.AreaChart(document.getElementById(divId));
                chart.draw(arrayData, options);
            }
          }
        });
      }
      
      getInteractions('interacciones_valoradas', g.toISOString().substring(0,10), d.toISOString().substring(0,10), getSession, 'chart_div', 'last30-channel')
      
      $('a[href="#by-range"]').on('shown.bs.tab', function (e){
        getInteractions('interacciones_valoradas', g.toISOString().substring(0,10), d.toISOString().substring(0,10), getSession, 'chart_by_range', 'desde-channel');
      });
      
      $('a[href="#by-week"]').on('shown.bs.tab', function (event){
        getInteractions('interacciones_valoradas', moment().subtract(7, 'days').format('YYYY-MM-DD'), moment().format('YYYY-MM-DD'), getSession, 'chart_by_week', 'week-channel');
      });
      
      $('a[href="#by-hour"]').on('shown.bs.tab', function (event){
        getInteractions('interacciones_valoradas', moment().format('YYYY-MM-DD'), moment().format('YYYY-MM-DD'), getSession, 'chart_by_hour', 'hour-channel')
      });
      
      $('a[href="#ranking"]').on('shown.bs.tab', function (event){
        getRanking();
      });
    </script>
  </body>
</html>