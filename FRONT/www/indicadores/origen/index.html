
<html lang="es-CL" dir="ltr" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://ogp.me/ns/fb#" heightfull="heightfull">
  <head>
    <title>Origen. MAD Cognitiva</title>
    <meta charset="UTF-8"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="apple-touch-icon" sizes="57x57" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/apple-icon-180x180.png"/>
    <link rel="icon" type="image/png" sizes="192x192" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/android-icon-192x192.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="96x96" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/favicon-96x96.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/favicon-16x16.png"/>
    <link rel="manifest" href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/manifest.json"/>
    <meta name="msapplication-TileColor" content="#000000"/>
    <meta name="msapplication-TileImage" content="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/ms-icon-144x144.png"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="_csrf" content=""/>
    <meta name="insight-app-sec-validation" content="4d0a31e7-ca78-40a0-b0dd-a0b8415541e4"/>
    <meta name="apptrana" content="37adefb730ca40ca9d12cb9e55ed2ca3"/>
    <link href="https://asistentedev-duoc.mycognitiva.io/assets/css/main.css" rel="stylesheet"/>
    <link href="https://asistentedev-duoc.mycognitiva.io/assets/img/favicon/favicon-32x32.png" rel="Shortcut Icon"/>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/constant.js"></script><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
  </head>
  <body class="no-scroll" heightfull="heightfull">
    <div id="wrapper" heightfull="heightfull">
      <div class="f-row" heightfull="heightfull">
        <div class="f-col menu active" heightfull="heightfull" padding="padding">
          <div class="header">
            <div class="f-row align-center">
              <div class="f-col cognitiva-logo"><img src="https://asistentedev-duoc.mycognitiva.io/assets/img/cognitiva-logo.png" alt=""/></div>
            </div>
          </div>
          <ul class="menu" id="mainmenu">
            <li id="config-asis-btn"><a href="https://asistentedev-duoc.mycognitiva.io/"><i class="fa fa-cog" aria-hidden="true"></i>Configurar Asistente</a></li>
            <li id="personalizar-asis-btn"><a href="https://asistentedev-duoc.mycognitiva.io/personalizar/"><i class="fa fa-paint-brush" aria-hidden="true"></i>Personalizar Asistente</a></li>
            <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/"><i class="fa fa-bar-chart" aria-hidden="true"></i>Indicadores</a>
              <ul class="sub-menu">
                <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/interacciones/"><i class="fa fa-caret-right" aria-hidden="true"></i>Interacciones</a></li>
                <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/origen/"><i class="fa fa-caret-right" aria-hidden="true"></i>Origen</a></li>
                <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/valoraciones/"><i class="fa fa-caret-right" aria-hidden="true"></i>Valoraciones</a></li>
                <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/nps/"><i class="fa fa-caret-right" aria-hidden="true"></i>NPS</a></li>
                <li><a href="https://asistentedev-duoc.mycognitiva.io/indicadores/me-gusta/"><i class="fa fa-caret-right" aria-hidden="true"></i>Me gusta</a></li>
              </ul>
            </li>
            <li id="admin-users-btn"><a href="https://asistentedev-duoc.mycognitiva.io/administrador-usuarios/"><i class="fa fa-users" aria-hidden="true"></i>Administrador Usuarios</a></li>
            <li id="get-code-btn"><a class="get-code" href="#;" onclick="openScript()"><i class="fa fa-code" aria-hidden="true"></i>Obtener código</a></li>
          </ul>
        </div>
        <div class="f-col content" padding="padding" heightfull="heightfull">
          <div class="row">
            <div class="col-md-12 content-header">
              <button class="btn menu" button="button" onclick="menu()"><i class="fa fa-bars"></i></button>
              <div class="mad-cognitiva">
                <h5>Mantenedor Asistente Digital / <span></span></h5>
              </div>
              <button class="user" button="button" onclick="closeSession()">
                <div id="user">Hola, <span>Ernesto</span></div><i class="fa fa-hand-peace-o"></i>
              </button>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h1 class="title-page">Origen</h1>
              <div class="container-tabs">
                <ul class="nav nav-tabs" id="tabs" role="tablist">
                  <li class="active" role="presentation"><a href="#last-days" aria-controls="last-days" role="tab" data-toggle="tab"><span>Últimos 30 días</span></a></li>
                  <li role="presentation"><a href="#by-range" aria-controls="by-range" role="tab" data-toggle="tab"><span>Por rango</span></a></li>
                </ul>
                <div class="tab-content has-title">
                  <div class="tab-pane fade in active" id="last-days" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="last30" type="text" data-date-end-date="0d" name="last30" placeholder="Seleccione" autocomplete="off"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('last30', 'origen', 'last-days', 'chart_div')">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Valoraciones por Origen <b>últimos 30 días</b> <span></span></h5>
                            <div id="chart_div"></div>
                          </div>
                        </div>
                      </div><a class="download-csv" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="by-range" role="tabpanel">
                    <div class="scroll">
                      <div class="row">
                        <div class="col-md-12">
                          <form onsubmit="event.preventDefault()">
                            <div class="row">
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="desde" type="text" data-date-end-date="0d" name="" placeholder="Seleccione desde" autocomplete="off"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <fieldset>
                                  <div class="form-group">
                                    <div class="input-group date">
                                      <input class="date-picker-days" id="hasta" type="text" data-date-end-date="0d" name="" placeholder="Seleccione hasta" autocomplete="off"/><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div class="col-md-3">
                                <button class="btn" button="button" onclick="getDateInput('desde', 'origen', 'by-range', 'chart_by_range')">Filtrar</button>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col-md-12">
                          <div class="inner">
                            <h5>Valoraciones por Origen <b>entre fechas</b></h5>
                            <div id="chart_by_range"></div>
                          </div>
                        </div>
                      </div><a class="download-csv" pull-right="pull-right">Descargar CSV<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i></button>
            <h6 class="modal-title"></h6>
          </div>
          <div class="modal-body"></div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="myModalScript" tabindex="-1" role="dialog" aria-labelledby="myModalScriptLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i></button>
            <h6 class="modal-title">Copia y pega el siguiente código en tu web. Después de <span class="code"><span>&lt;</span>head<span>&gt;</span></span> y antes de <span class="code"><span>&lt;/</span>head<span>&gt;</span></span></h6>
          </div>
          <div class="modal-body">
            <pre text-left="text-left"></pre>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/date.js"></script>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/crypto-js.min.js"></script>
    <script type="text/javascript" src="https://asistentedev-duoc.mycognitiva.io/assets/js/main.js"></script>
    <script>
      var d = new Date();
      var e = new Date();
          f = e.setDate(e.getDate() - 30);
          g = new Date(f);
      
      var month = new Array();
      month[0] = "Enero";
      month[1] = "Febrero";
      month[2] = "Marzo";
      month[3] = "Abril";
      month[4] = "Mayo";
      month[5] = "Junio";
      month[6] = "Julio";
      month[7] = "Agosto";
      month[8] = "Septiembre";
      month[9] = "Octubre";
      month[10] = "Noviembre";
      month[11] = "Diciembre";
      var n = month[d.getMonth()];
      var getSession = user.user_id,
        getTkn = user.tkn;
      
      function getDateInput(input, type, tab, chartName){
      
        var getInputVal   = document.getElementById(input).value,
            getDesde      = document.getElementById('desde').value,
            getHasta      = document.getElementById('hasta').value,
            desdeDate     = new Date(getDesde),
            hastaDate     = new Date(getHasta),
            getDate       = new Date(getInputVal),
            dateStart     = '',
            dateEnd       = '',
            getInputEnd   = document.getElementById('hasta').value;
      
        var getMonth      = getDate.getMonth(),
            getYear       = getDate.getFullYear();
      
        var lastDay       = new Date(getYear, getMonth + 1, 0),
            formatDate    = getDate.setDate(getDate.getDate() - 30),
            getDateFormat = new Date(formatDate),
            getDateFormat = getDateFormat.toISOString().substring(0,10);
      
        var myResponse    = '';
      
        if(tab == 'last-days'){
          dateEnd = getInputVal;
          dateStart = getDateFormat;
          getInteractions(type, dateStart, dateEnd, getSession, chartName);
        } else {
          if(desdeDate >= hastaDate) {
            $('#desde, #hasta').addClass('error');
            $('#desde, #hasta').parent().find('.input-group-addon').addClass('error');  
          } else {
            $('#desde, #hasta').removeClass('error');
            $('#desde, #hasta').parent().find('.input-group-addon').removeClass('error');
            dateEnd = getHasta;
            dateStart = getDesde;
            getInteractions(type, dateStart, dateEnd, getSession, chartName);
          }
        }
        return false;
      }
      
      $('.date-picker-days').datepicker({
        language: 'es',
        minViewMode: 'days'
      });
      
      function getInteractions(tipo, fechaIni, fechaFin, id, divId){
      
        var promise = $.ajax({
          type: 'POST',
          url: getPath+"mant/filtros",
          data:  JSON.stringify(
            {
              tipo: tipo,
              inicio: fechaIni,
              fin: fechaFin,
              id_cliente: id
            }
          ),
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer "+getTkn,
            "Cache-Control": "no-cache",
          },
          dataType: 'json',
          contentType: 'application/json; charset=utf-8'
        }).done(function(response){
          if(response.estado !== undefined && response.estado.codigoEstado !== 200){
            $('#'+divId).html('<p>No se han encontrado datos</p>');
            return false;
          }
      
          createCSV(response.csv, 'origen');
          google.charts.load("current", {packages:['corechart']});
          google.charts.setOnLoadCallback(drawChart);
          function drawChart() {
            var chartData = [['', 'Valoraciones', { role: "style" }]];
      
            if(response.descripcion[0])
              chartData.push(['APP', response.descripcion[0].cantidad , 'color: #1c75bc'])
      
            if(response.descripcion[1])
              chartData.push(['DESKTOP', response.descripcion[1].cantidad, 'color: #043d5d']);
      
            if(response.descripcion[2])
              chartData.push(['MOBILE', response.descripcion[2].cantidad, 'color: #1c75bc']);
      
            var data = google.visualization.arrayToDataTable(chartData);
            var view = new google.visualization.DataView(data);
            view.setColumns(
              [0, 1, {
                type: "string",
                role: "annotation"
              },
              2]
            );
            var options = {
              height: 280,
              hAxis: {
                textStyle: {
                  fontName: 'Roboto',
                  bold: true
                },
                title: '',
                titleTextStyle: {
                  color: '#f00'
                },
                minValue: 1,
                gridlines: {
                  color: 'none'
                }
              },
              vAxis: {
                minValue: 0,
                textStyle: {
                  fontName: 'Roboto',
                  bold: true
                }
              },
              chartArea:{
                left: '5%',
                top: '5%',
                width: '93%',
                height: '75%'
              },
              legend: 'none',
              pointSize: 9,
              tooltip: {
                showColorCode: true,
                textStyle: {
                  color: '#1c75bc',
                  fontName: 'Roboto',
                }
              },
              areaOpacity: .85,
              is3D: true,
              backgroundColor: {
                fill: 'transparent'
              },
              legend: {
                position: 'none'
              },
              bar: {
                groupWidth: "20%"
              }
            };
            var chart = new google.visualization.ColumnChart(document.getElementById(divId));
            chart.draw(view, options);
          }
      
        });
      }
      
      $('a[href="#by-range"]').on('shown.bs.tab', function (e) {
        getInteractions('origen', g.toISOString().substring(0,10), d.toISOString().substring(0,10), getSession, 'chart_by_range');
      })
      
      function initial(){
        if(hasToken){
          getInteractions('origen', g.toISOString().substring(0,10), d.toISOString().substring(0,10), getSession, 'chart_div');
        }else{
          setTimeout(()=>{
            initial();
          },300);
        }
      }
      
      initial();
    </script>
  </body>
</html>